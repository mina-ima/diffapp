📄 要件定義書：Diffapp（Ver1.2）

対象：スマホアプリ版（iOS/Android）・無料運用・子供向け

⸻

1. アプリ基本情報

項目	内容
アプリ名	Diffapp（ディフアップ）
ターゲット	小学生〜中学生
カテゴリ	教育／ゲーム／知育ツール
目的	2枚の画像からAIが自動で間違いを見つけ、視覚的にわかりやすく表示する。
利用料金	完全無料（課金・広告なし）
ネット接続	不要（すべてオフライン処理）
開発環境	Flutter（推奨）
実行環境	Android 9以降 / iOS 14以降


⸻

2. 機能要件（詳細）

2.1 トップ画面UI

要素	内容
タイトル表示	Diffappのロゴ＋キャッチコピー（例：「まちがいを みつけよう！」）
ボタン1	左の画像を選ぶ or 撮影（アイコン＋「ひだりがわ」表記）
ボタン2	右の画像を選ぶ or 撮影（アイコン＋「みぎがわ」表記）
次へ	「けんさを はじめる」ボタン（アイコン大＋アニメ付き）
設定	歯車アイコン（検出設定へ）


⸻

2.2 画像入力

項目	内容
カメラ撮影	スマホカメラを起動して1枚ずつ撮影（前後切替あり）
ギャラリー選択	端末内の画像を選択可能（jpg/png対応）
入力制限	解像度：〜4000×3000pxまで受け入れ、内部では自動リサイズ


⸻

2.3 比較範囲の指定

項目	内容
表示画面	左の画像を拡大表示し、指でドラッグして矩形選択するUI
選択方式	ドラッグで矩形を描画。再調整可。
トリミング範囲	指定矩形を、2枚目の画像にも自動適用（同じ座標）


⸻

2.4 画像補正処理（前処理）

処理	内容	使用技術（想定）
傾き補正	ORB/SIFTで特徴点抽出→ホモグラフィ変換で整列	OpenCV
サイズ統一	トリミング前にリサイズ（1280px幅目安）	OpenCV
トリミング	範囲指定矩形を元にトリミング	OpenCV
色調整（任意）	自動コントラスト調整（撮影環境補正）	OpenCV


⸻

2.5 比較対象の選択（検出設定）

設定項目	内容
チェックボックス	「いろ」「かたち」「ばしょ」「おおきさ」「もじ」からON/OFF
精度スライダー	ざっくり〜せいかく（3段階〜5段階程度）
初期設定	すべてON、精度：普通


⸻

2.6 検出処理（AI／画像処理）

処理内容	使用技術（想定）	詳細
差分抽出	SSIMアルゴリズム	入力画像からピクセル差を分析し、スコアマップ生成
類似度学習モデル	TensorFlow Lite（CNN）	特徴ベースで差を検出（テキスト・形などに強い）
最大件数制限	20個まで（スコア上位順に表示）	処理負荷軽減＆視認性確保のため制限


⸻

2.7 検出結果の表示UI

表示項目	内容
左右の画像表示	並べて表示（左右スクロールなし）
ハイライト表示	赤い枠で差異を囲う（アニメーション：ポヨン）
効果音（任意）	ピコッ／ポンッなど、見つけたタイミングで再生（ON/OFF設定）
スクショ案内	「けっかを スクリーンショットして ほぞんしよう！」を表示
再比較ボタン	「もういちど ちがうがぞうで ためす」ボタンあり


⸻

3. 非機能要件

項目	内容
オフライン対応	全処理をローカル実行。通信不要。
パフォーマンス	検出処理は最大5秒以内に完了することを目指す（1280px画像想定）
ストレージ	一時的な画像データはセッション終了時に削除
セキュリティ	画像はアプリ外に送信されない（プライバシー保護）
商用利用可否	全ライブラリ／技術はオープンソースライセンスのみを使用


⸻

4. 除外機能（今回のバージョンでは未対応）

項目	理由
結果の保存（ダウンロード）	子供向けの簡易操作に特化するため
結果の共有（SNS等）	保護者の管理を前提とする対象年齢のため
Web版の提供	ローカル推論とカメラ操作の難しさから分割対応予定