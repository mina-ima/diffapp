# Diffapp

Diffapp Ver1.2 — Flutter app (iOS/Android) for kids to spot differences between two images using on-device processing.

## Quick Start

- Requirements
  - Flutter 3.22.0 (recommended via FVM)
  - Dart SDK bundled with Flutter
- Setup
  - cd diffapp
  - Use pinned SDK: `fvm use 3.22.0` (or install Flutter 3.22.0 and skip FVM)
  - Install deps: `fvm flutter pub get`

## Commands

- Format: `fvm flutter format .`
- Lint/Analyze: `fvm flutter analyze`
- Test: `fvm flutter test`

## Run on Android Emulator

- One-liner from repo root: `pnpm android`
  - Internally: launches the first Android emulator and runs the Flutter app in `diffapp/`.
  - Prefers `fvm flutter` if available; falls back to `flutter`.
- Manual steps
  - Ensure Android SDK/Emulator installed (Android Studio > Device Manager)
  - `cd diffapp && fvm flutter pub get`
  - Launch an emulator (Android Studio or `flutter emulators --launch <id>`) and wait for boot
  - Run: `fvm flutter run -d <emulator-id> --target lib/main.dart`

## Build

- Android (Debug)
  - Ensure Android project exists under `diffapp/android` (if starting fresh, run `flutter create .` inside `diffapp/`).
  - Build: `fvm flutter build apk --debug`
  - Output: `diffapp/build/app/outputs/flutter-apk/app-debug.apk`
- iOS
  - Requires macOS. Open `ios/` in Xcode and build, or run `fvm flutter build ios`.

## CI

- GitHub Actions runs on push and PR:
  - Analyze + Test always.
  - Android Build (debug) automatically ensures platform folders by running `flutter create --org dev.minamidenshiimanaka .` in `diffapp/` if missing, then builds an APK.
  - iOS Build (simulator, no codesign) runs on macOS and uploads `Runner.app`.

## Development Flow

- TDD first: add a failing test under `test/`, then implement in `lib/`.
- Keep logic in Dart where possible; swap to native later via FFI.
- Prefer small, focused PRs with passing analyze/test.

## Directory Structure (proposed)

- `diffapp/lib/` — Dart source (e.g., `image_pipeline.dart`, `main.dart`)
- `diffapp/test/` — Dart tests
- `diffapp/android`, `diffapp/ios` — generated by Flutter as needed
- `docs/` — design notes (optional)
- Root: `spec.md`, `prompt_spec.md`, `todo.md`, `AGENTS.md`

## Identifiers

- Default package id (CI/local create): `dev.minamidenshiimanaka.diffapp`.
- To customize locally:
  - `cd diffapp && rm -rf android ios && fvm flutter create --org your.domain .`

## Repository Docs

- Specs: `prompt_spec.md`, `spec.md`
- Tasks: `todo.md`
- Contributor guide: `AGENTS.md`
- Emulator verification log: `diffapp/docs/emulator_verification_log.md`
- Detection pipeline plan: `diffapp/docs/detection_pipeline_plan.md`
